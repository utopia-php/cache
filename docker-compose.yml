version: '3.1'

services:  
  tests:
    container_name: tests
    build:
      context: .
      dockerfile: Dockerfile.php-${PHP_VERSION:-8.3}
    networks:
      - database
    volumes:
      - ./phpunit.xml:/usr/code/phpunit.xml
      - ./src:/usr/code/src
      - ./tests:/usr/code/tests
    
  redis:
    image: redis:6.0-alpine
    container_name: redis
    networks:
      - database

  hazelcast:
    image: hazelcast/hazelcast:5.1.3
    environment:
      HZ_NETWORK_MEMCACHEPROTOCOL_ENABLED: "true"
    container_name: hazelcast
    networks:
      - database

  memcached:
    image: memcached:1.6.17-alpine
    container_name: memcached
    networks:
      - database

  shardA:
    image: redis:6.0-alpine
    container_name: shardA
    networks:
      - database

  shardB:
    image: redis:6.0-alpine
    container_name: shardB
    networks:
      - database

  shardC:
    image: redis:6.0-alpine
    container_name: shardC
    networks:
      - database

networks:
  database:
